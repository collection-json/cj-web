<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.8" />
<title>Collection+JSON Tutorials : Consuming a Cj Response from a Client</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}


#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Collection+JSON Tutorials : Consuming a Cj Response from a Client</h1>
<span id="author">Mike Amundsen</span><br />
<span id="email"><code>&lt;<a href="mailto:mamund@yahoo.com">mamund@yahoo.com</a>&gt;</code></span><br />
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>In this short tutorial you&#8217;ll get a chance to see what it is like to
consume <a href="http://amundsen.com/media-types/collection/">Collection+JSON</a>(Cj)
responses emitted by a server. This is a very brief example
written as a simple HTML client in <a href="http://nodejs.org">nodejs</a>. This sample app focuses
on the process of accepting, parsing, and rendering Cj responses and
leaves out details of any complex full-screen rendering and other
client-side processing.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph"><p>This does not cover server-side generation of Cj responses. If you&#8217;re
looking for an example of coding for a <em>server</em> you can check out
the <a href="http://amundsen.com/media-types/tutorials/collection/tutorial-01.html">Generating
a Cj Response from a Server</a> tutorial.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Even though this tutorial illustrates a console client, it still covers the
basics of writing client apps for the Cj hypermedia format. This includes:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Handling a Cj Response
</p>
</li>
<li>
<p>
Handling Cj Items
</p>
</li>
<li>
<p>
Handling Cj Queries
</p>
</li>
<li>
<p>
Handling Cj Write Templates
</p>
</li>
<li>
<p>
Handling Cj Error Responses
</p>
</li>
</ol></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>The source code for this tutorial along with the original tutorial text
can be found in the <a href="http://github.com/collection-json/cj-web">cj-web</a>
repo in <a href="http://github.com">Github</a>. Feel free to fork/clone the project,
register issues, and issue PRs to help improve the tutorials repo.</p></div>
</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">Getting Started</h2>
<div class="sectionbody">
<div class="paragraph"><p>We need to take care of a few things before we dig into the details of
writing a console client that can handle Cj responses. First, we need to
identify a server we can use as we build the client and, second, we need to
set up a basic client framework to use as starter material for writing our
own client.</p></div>
<div class="sect2">
<h3 id="_using_the_tutorial_01_server">Using the Tutorial-01 Server</h3>
<div class="paragraph"><p>Since this tutorial focuses on the client side handling of Cj responses, we&#8217;ll
need to connect to a server that emits valid Cj representations. To keep things
really simple, there is a simple nodejs server app built just for this purpose.
It is designed to simply emit static responses for use in coding and testing
client apps. We won&#8217;t look at the server code now but, if you&#8217;re interested,
you can find it in the <a href="http://github.com/collection-json/cj-web">cj-web</a>
repository. It&#8217;s the server example built in
<a href="http://amundsen.com/media-types/tutorials/collection/tutorial-01.html">Generating
a Cj Response from a Server</a> tutorial.</p></div>
<div class="paragraph"><p>You can check out the code there to see how a server formats and emits valid
Cj responses. We won&#8217;t spend any time cover that here since there is already
a tutorial article that covers the details. However, you will need to download
and run the server on your local machine.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph"><p>The example server created in the <a href="http://amundsen.com/media-types/tutorials/collection/tutorial-01.html">Generating
a Cj Response from a Server</a> tutorial is set to listen on local port 1337.
If you change that setting, you&#8217;ll need to change all the corresponding code in
this client-side example, too.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_creating_the_browser_client_skeleton">Creating the Browser Client Skeleton</h3>
<div class="paragraph"><p>First, let&#8217;s build up a small skeleton of HTML, JS, and CSS to confirm all is working correctly.
This will give us the basic parts we need to complete the rest of the tasks for this tutorial and
it will provide some background on how to build hypermedia clients for Cj servers.</p></div>
<div class="sect3">
<h4 id="_the_html_container">The HTML Container</h4>
<div class="paragraph"><p>For this example, we&#8217;ll use HTML as a simple <em>container</em> for the rest of our work. This is not only
way to build hypermedia clients for Cj, but it is one of the easiest. Below is all the HTML we need
to get a working Cj client started:</p></div>
<div class="listingblock">
<div class="title">HTML Container for Cj Client</div>
<div class="content">
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;Tutorial-01 : Consuming a Cj Response from a Client&lt;/title&gt;
    &lt;link rel="stylesheet" href="client.css" /&gt;
    &lt;script src="client.js"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Consuming a Cj Response from a Client&lt;/h1&gt;
    &lt;div id="rawcj"&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_the_css_file">The CSS File</h4>
<div class="paragraph"><p>We only need a small CSS file to start this example. It has only one declaration so far:</p></div>
<div class="listingblock">
<div class="title">CSS File for Cj Client</div>
<div class="content">
<pre><code>#rawcj {
  font-family: monospace;
  white-space: pre;

}</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_the_js_file">The JS File</h4>
<div class="paragraph"><p>The JS file <em>looks</em> rather complicated to start with, but that&#8217;s just because we need to add in
support for doing direct HTTP (Ajax) requests within the script. The rest is very simple. Below is the
code that sets up communicating with the running <a href="http://amundsen.com/media-types/tutorials/collection/tutorial-01.html">Generating
a Cj Response from a Server</a> we built in Tutorial-01.</p></div>
<div class="listingblock">
<div class="title">Basic JS Scaffolding for a Cj Client</div>
<div class="content">
<pre><code>// fire onload
window.onload = function() {
  var pg = null;
  pg = cjClient();
  pg.init();
}

// actual client coding
cjClient = function() {

  var g = {};
  g.href = 'http://localhost:1337/';
  g.contentType = 'application/collection+json';
  g.data = null;

  function init() {
    getResponse(g.href);
  }

  // show just plain Cj response, no client-side parsing
  function displayRawCj() {
    var div;

    div = document.getElementById('rawcj');
    if(div) {
      div.innerHTML = JSON.stringify(g.data, null, 2);
    }
    else {
      alert('no rawcj');
    }
  }

  function getResponse(href) {
    var ajax;

    ajax=new XMLHttpRequest();
    if(ajax) {
      ajax.onreadystatechange = function(){processResponse(ajax);};
      ajax.open('get',href,false);
      ajax.send(null);
    }
  }

  function processResponse(ajax) {
    if(ajax.readyState==4 || ajax.readyState==='complete') {
      if(ajax.status===200 || ajax.status===204) {
        g.data = JSON.parse(ajax.responseText);
        displayRawCj();
      }
      else {
        alert('*** ERROR: '+ajax.status+'\n'+ajax.statusText);
      }
    }
  }

  // register events and return
  var that = {};
  that.init = init;
  return that;

}</code></pre>
</div></div>
<div class="paragraph"><p>Note that the code does only a couple things:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Establish shared variables including the starting URL and the media type identifier to use with requests.
</p>
</li>
<li>
<p>
Upon start up, perform a <code>getResponse(href)</code> operation to get a Cj representation from the server.
</p>
</li>
<li>
<p>
The Ajax call registers the <code>processResponse(ajax)</code> routine in order to handle the (eventual) server response.
</p>
</li>
<li>
<p>
The <code>DisplayRawCj()</code> routine is used to simply echo the server response into a single <code>DIV</code> tag on the screen.
</p>
</li>
</ol></div>
<div class="imageblock">
<div class="content">
<img src="images/tutorial-02-initial-test.png" alt="images/tutorial-02-initial-test.png" width="840" />
</div>
</div>
<div class="paragraph"><p>This is a simple way to test all the &#8220;plumbing&#8221; for the page; just to make sure all is working fine before we
step into the details of handling Cj responses. To test this app, simply load the <code>client.html</code> page in a browser. You should see a title and the exact Cj response sent by the server. If you see that, you&#8217;re all set. With this accomplished, we can start working a more complete and visually interesting hypermedia client for Cj responses.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_a_cj_response">Handling A Cj Response</h2>
<div class="sectionbody">
<div class="paragraph"><p>For this tutorial, handling Cj Response for a hypermedia client boils down to the following:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Make an HTTP request to the desired URL
</p>
</li>
<li>
<p>
Convert the response into an internal Cj object model
</p>
</li>
<li>
<p>
Render that Cj object model as HTML in the browser
</p>
</li>
</ol></div>
<div class="paragraph"><p>This, essentially, means creating a Cj parser for HTML clients. Starting this takes a bit of up front work, but
the good news is all the work will be re-usable for this and any other HTML client that you want to build for
Cj servers.</p></div>
<div class="sect2">
<h3 id="_make_an_http_request_to_the_desired_url">Make an HTTP Request to the Desired URL</h3>
<div class="paragraph"><p>We already got this working in our test case earlier in this tutorial. but it&#8217;s worth going over quickly again. The <code>getResponse(href)</code> routine uses the <code>href</code> argument to make an HTTP call to the designated server
and passes control to the <code>processResponse(ajax)</code> routine to handle the response. Most of the time, the
response will be a <code>200 OK</code> along with a Cj payload. If not, the code handles the error condition by
throwing up an alert box.</p></div>
<div class="listingblock">
<div class="title">Make an HTTP Request</div>
<div class="content">
<pre><code>  function getResponse(href) {
    var ajax;

    ajax=new XMLHttpRequest();
    if(ajax) {
      ajax.onreadystatechange = function(){processResponse(ajax);};
      ajax.open('get',href,false);
      ajax.send(null);
    }
  }

  function processResponse(ajax) {
    if(ajax.readyState==4 || ajax.readyState==='complete') {
      if(ajax.status===200 || ajax.status===204) {
        g.data = JSON.parse(ajax.responseText);
        displayRawCj();
      }
      else {
        alert('*** ERROR: '+ajax.status+'\n'+ajax.statusText);
      }
    }
  }</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph"><p>This example client only handles <code>GET</code> requests so the <code>getResponse(href)</code> routine is very simple. In a
fully-functioning Cj client, the code will need to handle <code>GET, POST, PUT</code> and <code>DELETE</code> requests.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_convert_the_response_into_an_internal_cj_object_model">Convert the response into an internal Cj object model</h3>
<div class="paragraph"><p>Once you have the response, it&#8217;s time to convert it into something the client can use. In our case, we&#8217;ll
convert the Cj response directly into a Javascript object tree. This is already handled for us in the test
code by the following line:</p></div>
<div class="listingblock">
<div class="title">Convert the response</div>
<div class="content">
<pre><code>  g.data = JSON.parse(ajax.responseText);</code></pre>
</div></div>
<div class="paragraph"><p>This gives us an internal representation of the Cj response that we can use to create a visual rendering
of the Cj representation.</p></div>
</div>
<div class="sect2">
<h3 id="_render_that_cj_object_model_as_html_in_the_browser">Render that Cj object model as HTML in the browser</h3>
<div class="paragraph"><p>For this first example, we&#8217;ll render only the top-most elements of the Cj representation:</p></div>
<div class="ulist"><ul>
<li>
<p>
the version,
</p>
</li>
<li>
<p>
the root href, and
</p>
</li>
<li>
<p>
the top-level links collection
</p>
</li>
</ul></div>
<div class="paragraph"><p>To do this, we&#8217;ll create some helper functions in our client app.</p></div>
<div class="sect3">
<h4 id="_the_getversion_helper">The getVersion() Helper</h4>
<div class="paragraph"><p>This returns the declared version of the Cj response or, if none is included, returns "0.0".</p></div>
<div class="listingblock">
<div class="title">getVersion()</div>
<div class="content">
<pre><code>  function getVersion(data) {
    return (data.collection.version?data.collection.version:'0.0');
  }</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_the_getrooturl_helper">The getRootUrl() Helper</h4>
<div class="paragraph"><p>This returns the root URL of the Cj response or, if none is included, returns a blank string.</p></div>
<div class="listingblock">
<div class="title">getRootUrl()</div>
<div class="content">
<pre><code>  function getRootUrl(data) {
    return (data.collection.href?data.collection.href:'');
  }</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_the_getlink_cjlink_helper">the getLink(cjLink) Helper</h4>
<div class="paragraph"><p>This returns an HTML object for the Cj link element passed into the function. This is a rather smart routine,
too. If <code>link.render='image'</code> then the routine returns a fully-populared HTML <code>img</code> control. Otherwise the
routine returns a fully-populated HTML <code>a</code> control.</p></div>
<div class="listingblock">
<div class="title">getLink(cjLink)</div>
<div class="content">
<pre><code>  function getLink(link) {
    var rtn;

    if(link.render &amp;&amp; link.render==='image') {
      rtn = document.createElement('img');
      rtn.src = (link.href?link.href:'#');
      rtn.className = (link.rel?link.rel:'');
      rtn.alt = (link.prompt?link.prompt:rtn.src);
      rtn.title = rtn.alt;
    }
    else {
      rtn = document.createElement('a');
      rtn.href = (link.href?link.href:'#');
      rtn.rel = (link.rel?link.rel:'');
      rtn.appendChild(document.createTextNode((link.prompt?link.prompt:rtn.rel)));
      rtn.title = rtn.rel;
    }
    return rtn;
  }</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>The example response for this tutorial does not include any elements where the <code>link.render='image'</code> but
other examples later will.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_putting_it_all_together">Putting it all together</h4>
<div class="paragraph"><p>Now that we have all the helpers we need for this task, we can write a single routine that uses them to
render the top-level Cj response information in the HTML browser.</p></div>
<div class="listingblock">
<div class="title">handleCjResponse()</div>
<div class="content">
<pre><code>  function handleCjResponse() {
    var div, links, i, x, ul, li, a;

    // show version and rootUrl
    div = document.getElementById('rawcj');
    if(div) {
      div.innerHTML = '';
      div.innerHTML = 'Version: ' + getVersion(g.data) + '&lt;br /&gt;';
      div.innerHTML += 'RootURL: ' + getRootUrl(g.data);
    }

    // add any top-level links
    if(g.data.collection.links) {
      links = g.data.collection.links;

      ul = document.createElement('ul');
      ul.className = 'topLinks';

      for(i=0,x=links.length;i&lt;x;i++) {
        a = getLink(links[i]);
        li = document.createElement('li');
        li.appendChild(a);
        ul.appendChild(li);
      }
      div.appendChild(ul);
    }
  }</code></pre>
</div></div>
<div class="paragraph"><p>Next we add a call to <code>handleCjResponse()</code> in the <code>processResponse(ajax)</code> routine (right after the <code>displayRawCj()</code> line. Now <code>processResponse(ajax)</code> looks like this:</p></div>
<div class="listingblock">
<div class="title">Updated processResponse()</div>
<div class="content">
<pre><code>  function processResponse(ajax) {
    if(ajax.readyState==4 || ajax.readyState==='complete') {
      if(ajax.status===200 || ajax.status===204) {
        g.data = JSON.parse(ajax.responseText);
        displayRawCj();
        handleCjResponse();
      }
      else {
        alert('*** ERROR: '+ajax.status+'\n'+ajax.statusText);
      }
    }
  }</code></pre>
</div></div>
<div class="paragraph"><p>Now, when you load your <code>client.html</code> page in the browser, it displays the Cj version, Cj root URL, and the &#8220;home&#8221; link.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/tutorial-02-handling-cj-response.png" alt="images/tutorial-02-handling-cj-response.png" width="840" />
</div>
</div>
<div class="paragraph"><p>Now that we can handle the basic information in a Cj response and have an idea of how to build helper functions, the next step is to handle the <code>item</code> collection in Cj responses and render them in HTML.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_cj_items">Handling Cj Items</h2>
<div class="sectionbody">
<div class="paragraph"><p>TK</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_cj_queries">Handling Cj Queries</h2>
<div class="sectionbody">
<div class="paragraph"><p>TK</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_cj_write_templates">Handling Cj Write Templates</h2>
<div class="sectionbody">
<div class="paragraph"><p>TK</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_cj_error_responses">Handling Cj Error Responses</h2>
<div class="sectionbody">
<div class="paragraph"><p>TK</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph"><p>TK</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2013-11-03 12:59:29 Eastern Standard Time
</div>
</div>
</body>
</html>
